# pi_cam_stream 使用說明

## 目錄結構

- `pi_stream.py`：主程式，用於啟動樹梅派 CSI 攝影機串流。

- `pi_stream.sh`：啟動腳本，方便執行主程式。

- `pi_requirements.txt`：Python 依賴清單。

- `setup_pi.sh`：自動安裝依賴並啟動主程式。

## 使用方法

### 0. 提高系統權限

```bash
chmod +x pi_stream.sh
chmod +x setup_pi.sh
```

### 1. 安裝依賴

執行以下命令以安裝所需依賴：

```bash
sudo ./setup_pi.sh
```

### 2. 啟動串流

執行以下命令啟動串流：

```bash
sudo ./pi_stream.sh
```

### 3. 查看串流

在瀏覽器中打開以下網址：

```bash
http://<樹梅派IP>:5000/video
```

### 4. QR Code

執行主程式後，會生成 QR Code，方便快速訪問串流網址。

## 注意事項

1. **權限問題**：

   - `pi_stream.sh` 腳本需要提高權限執行，請使用 `sudo`。

   - 若不希望每次輸入密碼，可參考以下方法：

     - 編輯 `/etc/sudoers` 文件，設置無需密碼的 `sudo`。

     - 使用 `setuid` 提高腳本執行權限。

2. **相機資源釋放**：

   - 若相機資源被佔用，主程式會自動檢查並釋放。

   - 若釋放失敗，請手動執行以下命令：

     ```bash
     sudo lsof /dev/video0
     sudo kill -9 <PID>
     ```

3. **依賴安裝**：

   - 確保已安裝 Python 3 和必要的套件（例如 Flask、Picamera2）。

   - 若安裝失敗，請檢查網路連線或套件版本。

4. **路徑問題**：

   - 確保腳本中的路徑正確，否則可能導致執行失敗。

5. **安全性**：

   - 若使用 `sudo` 無需密碼或 `setuid`，請注意可能存在安全風險。

## 常見問題

### 問題 1: 無法啟動相機

- **原因**：相機資源被佔用。

- **解決方法**：執行 `lsof` 和 `kill` 釋放資源。

### 問題 2: 串流顏色異常

- **原因**：色彩空間處理問題。

- **解決方法**：確保程式中已正確轉換為 RGB。

### 問題 3: QR Code 無法顯示

- **原因**：PIL 或桌面環境未安裝。

- **解決方法**：檢查 PIL 安裝狀態，並嘗試生成 QR Code 圖片。

若有其他問題，請隨時聯繫開發者！